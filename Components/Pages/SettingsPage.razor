@page "/Settings"
@using Zine.App.Common
@using Zine.App.Domain.Settings
@using Zine.App.Exceptions
@using Zine.Components.Components.Settings

@implements IDisposable

@inject ISettingsService SettingsService
@inject ISnackbar Snackbar


<div class="flex flex-col items-center w-1/3 mx-auto">
	<HomePageSettings SettingsValues="Settings" SettingsValuesChanged="SettingsUpdated"/>
</div>

@code
{
	Settings Settings { get; set; } = new();

	private readonly Debouncer _debouncer = new();


	void LoadSettings()
	{
		Settings = SettingsService.Get();
	}

	void SettingsUpdated(Settings settings)
	{
		_debouncer.DebounceAsync(300, _ => SaveSettings(settings));
	}

	void SaveSettings(Settings settings)
	{
		try
		{
			SettingsService.UpdateMany(settings);
		}
		catch (HandledAppException e)
		{
			Snackbar.Add(e.Message, e.Severity);
		}
	}

	protected override void OnInitialized()
	{
		base.OnInitialized();
		LoadSettings();
	}

	public void Dispose()
	{
		_debouncer.Dispose();
	}
}
